--------------------------------------------------
PROJECT DEVLOG
--------------------------------------------------

PHASE 1 - ENVIRONMENT AND PROJECT SETUP

Status: COMPLETE


WHAT WAS ADDED
--------------
- Git repository initialized
- PyCharm project created
- Virtual environment (venv) created and activated
- Required libraries installed:
    numpy
    scipy
    matplotlib
    opencv-python
- requirements.txt generated using pip freeze
- Project folder structure created:
    src/
    data/
    data/test/
    outputs/
    reports/
    presentation/
- Global configuration file created:
    src/config.py
    (contains parameters and random seed)
- Environment test file created:
    test_env.py
- test_env.py executed successfully
- outputs/ folder confirmed working


WHAT WAS CHANGED
----------------
- No existing code modified (initial setup phase)


WHAT WAS NOT ADDED YET
----------------------
- No simulation engine implemented
- No robot dynamics implemented
- No numerical integrator implemented
- No visualization system implemented
- No path extraction implemented
- No swarm logic implemented
- No optical flow or video processing implemented
- No report or presentation created


NOTES
-----
- Python environment fully working
- All required libraries installed and confirmed
- Project reproducible via requirements.txt
- Folder structure ready for development
- Ready to begin Phase 2 (simulation engine)

=============================================================
PHASE 2 - CORE SIMULATION ENGINE + TESTING INFRASTRUCTURE
=============================================================

STATUS: COMPLETE AND VALIDATED

This phase implemented the full robot simulation engine, numerical solver,
visualization system, structured outputs, and automated testing framework.
All components were tested together and validated using system_tester.py.

-------------------------------------------------------------
FILES ADDED
-------------------------------------------------------------

src/core.py
-----------
Main simulation engine containing:
- Robot state initialization
- Velocity clipping (speed limiting)
- Attraction force toward target
- Repulsion force between robots
- Damping force
- Total acceleration computation
- RK2 midpoint numerical integrator
- Full simulation loop (run_simulation)
- Optional velocity history storage for testing

Purpose:
Centralized all simulation logic into a single core module.


src/io_utils.py
---------------
Utilities for output and project path management:
- get_project_root()
- ensure_output_root()
- create_new_results_dir()

Purpose:
Automatically create incrementing results folders:
  /output/results_0001/
  /output/results_0002/
and manage file-safe paths.


src/viz.py
----------
Visualization module:
- plot_trajectory()
- Saves trajectory plots into provided results directory

Purpose:
Standardized visualization saving into structured output folders.


system_tester.py
----------------
Global automated testing runner:
- Discovers all test files in /src/test/
- Runs each test file
- Creates new results folder per run
- Stores test artifacts in:
    /output/results_xxxx/tests/
- Prints readable PASS/FAIL output
- Returns exit code:
    0 = success
    2 = failure

Purpose:
Centralized quality-control system for entire project.


src/test/_test_utils.py
-----------------------
Testing helper context:
- Standardized PASS/FAIL/INFO printing
- Provides safe path creation inside results_dir
- Collects metrics

Purpose:
Improves readability and consistency across all tests.


src/test/test_dynamics_basic.py
-------------------------------
Primary Phase 2 validation test:
Tests:
1. Robot moves toward target
2. Speed never exceeds VMAX (true velocity check)
3. Repulsion increases separation between robots

Outputs:
- trajectory plots
- metrics printed
- PASS/FAIL status returned

Purpose:
Validates full simulation engine correctness.


TESTING BLUEPRINT DOCUMENT
--------------------------
A full text blueprint defining:
- Test discovery rules
- Test file structure
- Naming conventions
- Output conventions
- Example template

Purpose:
Ensures consistent test development across future phases.


-------------------------------------------------------------
FILES MODIFIED
-------------------------------------------------------------

src/config.py
-------------
Confirmed global parameters:
- DT
- VMAX
- KP
- KD
- KREP
- RSAFE
- ROBOT_RADIUS
- N_ROBOTS
- random seed

Used consistently across simulation and tests.


src/core.py (updates during phase)
----------------------------------
- Replaced Euler integrator with RK2 midpoint integrator
- Added optional velocity history storage for accurate testing
- Ensured velocity clipping always applied
- Stabilized numerical behavior


src/viz.py (refactored)
-----------------------
Changed from direct output dumping to:
save into provided results_dir

Now integrates with system_tester results folders.


-------------------------------------------------------------
SYSTEM FEATURES IMPLEMENTED
-------------------------------------------------------------

1. PHYSICS ENGINE
-----------------
- Multi-robot support
- Stable RK2 integration
- Collision avoidance via repulsion
- Velocity limiting
- Damping stabilization
- Target attraction

2. OUTPUT MANAGEMENT
--------------------
- Automatic creation of structured results folders
- Each run stored separately
- No overwriting of previous outputs

3. AUTOMATED TESTING
--------------------
- System-wide test discovery
- Standardized test format
- PASS/FAIL reporting
- Metrics logging
- Exit codes for validation

4. QUALITY CONTROL
------------------
All Phase 2 components tested together:
- Simulation correctness
- Velocity constraints
- Repulsion behavior
- Output generation
- Folder structure integrity

All tests passing.


-------------------------------------------------------------
WHAT WORKS NOW
-------------------------------------------------------------
- Full robot motion simulation (IVP system)
- RK2 numerical integration
- Multi-robot interaction
- Stable velocity constraints
- Visualization pipeline
- Structured output storage
- Automated test runner
- Reproducible simulation runs


-------------------------------------------------------------
NOTES
-------------------------------------------------------------
Phase 2 establishes the complete simulation core used by all
later phases.

All future work (path following, swarm coordination, pedestrian
navigation) will build on this engine without modifying its
fundamental structure.

Phase 2 is considered stable and complete.

=============================================================
END PHASE 2
=============================================================

=============================================================
PHASE 3 - MAP PROCESSING, SPLINE PATH & PHYSICS-BASED PATH FOLLOWING
=============================================================

STATUS: COMPLETE AND FULLY VALIDATED

This phase implemented the full path-extraction pipeline from map input to
physics-based robot path following with formal validation and visualization.

All modules are now integrated into the main simulation engine and verified
through automated system testing.

-------------------------------------------------------------
FILES ADDED
-------------------------------------------------------------

src/map_tools/map_loader.py
----------------------------
Loads map image and provides access to map dimensions and pixel data.

Purpose:
Centralized map loading and validation for all later processing steps.


src/map_tools/map_click_ab.py
-----------------------------
Interactive UI allowing user to select start (A) and end (B) points.

Features:
- Click A and B on map
- ESC cancel support
- Stores coordinates in config
- Reuses stored A/B if already defined

Purpose:
Provides reproducible and user-controlled path endpoints.


src/path_extraction.py
----------------------
Extracts walkable path from map image.

Features:
- Binary mask extraction
- Walkable region detection
- A/B validation inside path
- Centerline extraction from path mask

Purpose:
Transforms map image into navigable path representation.


src/centerline.py
-----------------
Processes extracted path mask to generate ordered centerline.

Features:
- Skeletonization of path
- Ordered centerline point extraction
- Ensures continuous path
- Debug visualization support

Purpose:
Creates geometric path backbone used for spline fitting.


src/spline_path.py
------------------
Builds continuous spline representation from centerline.

Features:
- Arc-length parameterized spline
- p(s): position along path
- tangent(s): unit tangent
- closest_s(x): nearest path coordinate
- Path length computation

Purpose:
Provides continuous path representation for controller and constraints.


src/path_controller.py
----------------------
Moving-target path following controller.

Features:
- Progress parameter along spline
- Closest point projection
- Lookahead target generation
- Stable forward progression

Purpose:
Generates dynamic target for robot to follow spline smoothly.


src/constraints.py
------------------
Path boundary and corridor validation.

Features:
- distance_to_path()
- is_inside_path()
- Border violation measurement
- Corridor width handling

Purpose:
Ensures robot remains within walkable path region.


src/viz.py (extended)
---------------------
Added path visualization utilities:

- render_path_following()
- Centerline plotting
- Robot trajectory plotting
- GIF generation
- Debug overlays

Purpose:
Unified visualization for debugging and validation.


-------------------------------------------------------------
FILES ADDED - TESTING
-------------------------------------------------------------

src/test/test_point_extraction.py
---------------------------------
Validates map loading, A/B selection, mask extraction, and centerline.

Outputs debug images for verification.


src/test/test_spline_path.py
----------------------------
Validates spline construction and geometry functions:
- Finite endpoints
- Normalized tangents
- closest_s correctness
- Spline length sanity


src/test/test_path_controller.py
--------------------------------
Validates controller outputs:
- Target numeric validity
- Progress initialization
- Stable parameter updates


src/test/test_constraints.py
----------------------------
Validates corridor logic:
- Distance to path correctness
- Inside/outside detection
- Border tolerance checks


src/test/test_path_following.py
-------------------------------
Simulates robot following spline using physics engine.

Confirms robot can follow entire path visually and numerically.


src/test/test_subproblem_1_validation.py
----------------------------------------
Formal validation of full system.

Checks:
- Robot reaches end of spline
- Stays within path borders
- Uses real RK2 physics
- Uses controller targets
- Progress measured via closest_s()

Simulation length automatically computed using:
- Path length
- VMAX
- DT

Ensures consistent validation independent of map.


src/test/test_visualization.py
------------------------------
Validates visualization pipeline and GIF export.


-------------------------------------------------------------
FILES MODIFIED
-------------------------------------------------------------

src/config.py
-------------
Added global path and map parameters:
- PATH_WIDTH / PATH_WIDTH_PIX
- Map path configuration
- A/B storage
- Controller tuning values

Ensures consistent configuration across modules.


src/core.py
-----------
Physics engine reused from Phase 2.

Confirmed compatibility with:
- Path controller targets
- Long-duration simulation
- Stable RK2 integration


src/viz.py
----------
Extended to support:
- Map overlays
- Centerline rendering
- Path following animation
- Validation plotting


system_tester.py
----------------
Now runs full Phase 3 test suite automatically.

Produces:
output/results_xxxx/tests/

with all debug images and animations.


-------------------------------------------------------------
SYSTEM FEATURES IMPLEMENTED
-------------------------------------------------------------

1. MAP -> PATH PIPELINE
-----------------------
Map image -> mask -> centerline -> spline -> controller -> robot motion


2. CONTINUOUS SPLINE PATH
-------------------------
Arc-length parameterized path
Closest-point projection
Smooth tangents
Lookahead targeting


3. PHYSICS-BASED PATH FOLLOWING
-------------------------------
Robot follows spline using real RK2 dynamics
NOT kinematic teleporting
Fully compatible with Phase 2 engine


4. PATH CONSTRAINT VALIDATION
-----------------------------
Distance-to-path checks
Inside/outside detection
Border violation metrics


5. FORMAL SYSTEM VALIDATION
---------------------------
Automated test confirms:
- Robot reaches goal
- Remains inside corridor
- Simulation stable for full path
- Works across multiple A/B selections


6. VISUAL DEBUGGING
-------------------
Generated artifacts:
- Centerline debug images
- Mask overlays
- Path following plots
- Validation plots
- GIF animations


-------------------------------------------------------------
WHAT WORKS NOW
-------------------------------------------------------------

- Map loading and validation
- Interactive A/B selection
- Path mask extraction
- Centerline extraction
- Continuous spline generation
- Moving-target path controller
- Physics-based robot following
- Corridor constraint enforcement
- Full visualization pipeline
- Automated multi-stage testing
- Formal path-following validation


-------------------------------------------------------------
NOTES
-------------------------------------------------------------

Phase 3 completes the full single-robot navigation pipeline from
map input to validated path following using real physics.

All modules are now stable, integrated, and tested through the
system tester.

This phase establishes the foundation required for:

- Multi-robot path following
- Swarm coordination
- Dynamic obstacle handling
- Pedestrian simulation
- Video-based navigation

Phase 3 is considered COMPLETE and STABLE.

=============================================================
END PHASE 3
=============================================================
